(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{108:function(e,t,n){},109:function(e,t,n){},158:function(e,t){},160:function(e,t){},169:function(e,t,n){"use strict";n.r(t);var c=n(0),i=n(32),o=n.n(i),s=(n(92),n(7)),a=(n(93),n(94),n(182)),r=n(3),l=n(2),d=n(46),u=function(e){var t=e.id,n=e.disable,c=e.joinDisable,i=Object(r.f)(),o=d.generate();return Object(l.jsxs)("div",{className:"header",children:[Object(l.jsx)(a.a,{variant:"primary",size:"lg",disabled:n,onClick:function(){i.push("".concat(o,"#init"))},children:"Create Broadcast"}),Object(l.jsx)(a.a,{variant:"primary",size:"lg",disabled:c,onClick:function(){i.push("/".concat(t))},children:"Join Now"})]})},j=n(45),g=(n(108),n(109),n(84)),b=n.n(g),h=n(85),O=n.n(h),f=n(40),m=function(e){return f({method:"delete",url:"/api/:id",data:{id:e}})},v=function(e){var t=e.id,n=e.isAdmin,c=e.screenShare,i=e.isPresenting,o=e.disconnect,s=Object(r.f)();return console.log(n),Object(l.jsxs)("div",{className:"footer-block",children:[Object(l.jsx)("div",{className:"icon-block phone",onClick:function(){"#init"===window.location.hash&&m(t),o(),s.push("/")},children:Object(l.jsx)(b.a,{})}),n&&Object(l.jsxs)("div",{className:"icon-block screen-share",onClick:function(){c()},children:[Object(l.jsx)(O.a,{}),i?Object(l.jsx)("p",{className:"title",children:"Stop now"}):Object(l.jsx)("p",{className:"title",children:"Present now"})]})]})},p=n(86),w=n.n(p),x=n(44),k=n.n(x),S=n(40),D=n.n(S),y=n(46),I=function(e){var t=e.setJoinDisable,n=e.setDisable,i=(Object(r.f)(),Object(c.useRef)()),o=Object(c.useRef)(),a=Object(c.useState)(),d=Object(s.a)(a,2),u=d[0],g=d[1],b=Object(c.useRef)(),h=Object(r.g)().id,O=Object(c.useRef)([]),f=Object(c.useState)([]),p=Object(s.a)(f,2),x=p[0],S=p[1],I=Object(c.useState)([]),V=Object(s.a)(I,2),E=(V[0],V[1],Object(c.useState)(!1)),T=Object(s.a)(E,2),R=T[0],N=T[1],C=(Object(c.useRef)(),Object(c.useRef)()),A=Object(c.useState)(!1),J=Object(s.a)(A,2),P=J[0],B=J[1],L=Object(c.useState)(),M=Object(s.a)(L,2),U=(M[0],M[1]),z=Object(c.useState)([]),q=Object(s.a)(z,2),F=(q[0],q[1]);"#init"===window.location.hash&&window.addEventListener("beforeunload",(function(e){m(h),e.returnValue="Are you sure you want to exit?",console.log(e.returnValue)})),Object(c.useEffect)((function(){b.current=w.a.connect("/"),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){g(e);var t=document.getElementById("localCanvas");console.log(e),"#init"===window.location.hash&&navigator.mediaDevices.getDisplayMedia({cursor:!0}).then((function(n){var c=n,s=document.getElementById("adminVid"),a=document.getElementById("ssVideo");a.hidden=!1,t.hidden=!1,s.style.width="0",s.style.height="0",a.style.width="0",a.style.height="0",console.log(n.getVideoTracks()[0].getSettings().width),t.width=n.getVideoTracks()[0].getSettings().width,t.height=n.getVideoTracks()[0].getSettings().height;var r=t.getContext("2d");setInterval((function(){t.width!==c.getVideoTracks()[0].getSettings().width&&(t.width=c.getVideoTracks()[0].getSettings().width,t.height=c.getVideoTracks()[0].getSettings().height);var e=t.height-240,n=t.width-320;r.drawImage(a,0,0),r.drawImage(s,n,e,320,240)}),33),"#init"===window.location.hash&&(i.current.srcObject=e,C.current=b.current.id,B(!0),o.current.srcObject=n,g(e)),e=t.captureStream(30),U(t.captureStream(30))})),console.log("JOINED ROOM"),b.current.emit("roomID",h),b.current.on("all users",(function(t){if(console.log(t.length),F(t),console.log(b.current),t[0]!==b.current.id){var n=function(e,t,n){console.log("CREATE PEER"),console.log(n);var c=new k.a({initiator:!0,trickle:!1,stream:n});return console.log(e+"  "+t),c.on("signal",(function(n){b.current.emit("sending signal",{userToAdmin:e,callerID:t,signal:n})})),c.on("stream",(function(e){console.log(e),i.current.srcObject=e,g(e)})),c}(t[0],b.current.id,e);console.log(e),O.current.push({peerID:t[0],peer:n}),S((function(e){return[].concat(Object(j.a)(e),[n])}))}})),b.current.on("user joined",(function(t){var n=function(e,t,n){console.log("Add Peer");var c=new k.a({initiator:!1,trickle:!1,stream:n});return c.signal(e),c.on("signal",(function(e){b.current.emit("returning signal",{signal:e,callerID:t})})),c}(t.signal,t.callerID,e);O.current.push({peerID:t.callerID,peer:n}),S((function(e){return[].concat(Object(j.a)(e),[n])}))})),b.current.on("receiving returned signal",(function(e){var t=O.current.find((function(t){return t.peerID===e.id}));console.log(t),t.peer.signal(e.signal)}))}))}),[]);return Object(l.jsxs)("div",{class:"videoScreen",children:[Object(l.jsxs)("div",{className:"container",children:[Object(l.jsx)("video",{className:"adminVid",id:"adminVid",ref:i,muted:!0,autoPlay:!0,controls:!0}),Object(l.jsx)("video",{id:"ssVideo",ref:o,muted:!0,autoPlay:!0,playsinline:!0,controls:!0,hidden:!0}),Object(l.jsx)("canvas",{hidden:!0,id:"localCanvas"})]}),Object(l.jsx)("div",{className:"footer-body",children:Object(l.jsx)(v,{id:h,isPresenting:R,screenShare:function(){var e=y.generate();D()({method:"post",url:"api/".concat(h,"/").concat(e),idRoom:e}),b.current.emit("ssIdUser",e),console.log(e),navigator.mediaDevices.getDisplayMedia({cursor:!0}).then((function(e){console.log("SCREEN STREAM",e),console.log(i.current);var t=document.getElementById("ssVideo");"srcObject"in t?t.srcObject=e:t.src=window.URL.createObjectURL(e),t.play(),x.map((function(t,n){console.log(t),t.replaceTrack(u.getVideoTracks()[0],e.getVideoTracks()[0],u)})),N(!0),e.getTracks()[0].onended=function(){x.map((function(t,n){console.log("CALLED"),t.replaceTrack(e.getVideoTracks()[0],u.getVideoTracks()[0],u)})),N(!1)}}))},isAdmin:P,setJoinDisable:t,setDisable:n,disconnect:function(){b.current.disconnect()}})})]})},V=n(31);var E=function(){var e=Object(c.useState)(),t=Object(s.a)(e,2),n=t[0],i=t[1],o=Object(c.useState)(!1),a=Object(s.a)(o,2),d=a[0],j=a[1],g=Object(c.useState)(!0),b=Object(s.a)(g,2),h=b[0],O=b[1];return Object(c.useEffect)((function(){f.get("/api").then((function(e){console.log(e.data.length),0===e.data.length?(j(!1),O(!0)):(console.log(e),i(e.data[0]),j(!0),O(!1))}))}),[]),Object(l.jsx)("div",{className:"App",children:Object(l.jsx)(V.a,{children:Object(l.jsxs)(r.c,{children:[Object(l.jsx)(r.a,{exact:!0,path:"/",children:Object(l.jsx)(u,{id:n,disable:d,joinDisable:h})}),Object(l.jsx)(r.a,{exact:!0,path:"/:id",children:Object(l.jsx)(I,{setJoinDisable:O,setDisable:j})})]})})})};o.a.render(Object(l.jsx)(E,{}),document.getElementById("root"))},92:function(e,t,n){},93:function(e,t,n){},94:function(e,t,n){}},[[169,1,2]]]);
//# sourceMappingURL=main.cc8fc7c8.chunk.js.map